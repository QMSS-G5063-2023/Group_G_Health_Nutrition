---
title: "Group G Health & Nutrition Website"
author: "Moises Escobar, Justin Ko, Kexu Duan, Yiwei Li"
output:
  prettydoc::html_pretty:
    theme: cayman

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, results = 'hide', message = FALSE, warning = FALSE, error = FALSE, message = FALSE}
# Load all packages
library(readxl)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(geojsonio)
library(leaflet)
library(DT)
library(shiny)
library(RColorBrewer)
library(readr)
library(leaflet.extras)
library(sf)
library(plotly)
library(tidyverse)
library(lubridate)
library(stringr)
library(wordcloud2)
library(countrycode)
library(ggimage)
```

```{r, echo=FALSE, results = 'hide', message = FALSE, warning = FALSE, error = FALSE, message = FALSE}
centiment <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/centiment_survey.xlsx")
analysis <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/survey_analysis.xlsx")
states <- geojsonio::geojson_read("https://rstudio.github.io/leaflet/json/us-states.geojson",
                                  what = "sp")
obesity_11 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_11.xlsx")
obesity_12 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_12.xlsx")
obesity_13 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_13.xlsx")
obesity_14 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_14.xlsx")
obesity_15 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_15.xlsx")
obesity_16 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_16.xlsx")
obesity_17 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_17.xlsx")
obesity_18 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_18.xlsx")
obesity_19 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_19.xlsx")
obesity_20 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_20.xlsx")
obesity_21 <- read_excel("/Users/justin/Downloads/drive-download-20230503T031622Z-001/state_obesity_21.xlsx")

# EDA
lbs_to_kg <- 2.20462
in_to_ft <- 12
in_to_m <- 39.3701
cent_final <- centiment %>%
  mutate(weight_kg = `Weight (in pounds)` / lbs_to_kg,
         height_ft = as.numeric(`Height (in feet and inches) Feet`),
         height_in = as.numeric(`Height (in feet and inches) Inches`),
         height_m = (height_ft * in_to_ft + height_in) / in_to_m,
         bmi = weight_kg / height_m^2) %>%
  cbind(analysis)

# U.S. Map 2011
states@data <- cbind(states@data, obesity_11)
states_11 <- states 

# U.S. Map 2012
states@data <- cbind(states@data, obesity_12)
states_12 <- states

# U.S. Map 2013
states@data <- cbind(states@data, obesity_13)
states_13 <- states

# U.S. Map 2014
states@data <- cbind(states@data, obesity_14)
states_14 <- states

# U.S. Map 2015
states@data <- cbind(states@data, obesity_15)
states_15 <- states

# U.S. Map 2016
states@data <- cbind(states@data, obesity_16)
states_16 <- states

# U.S. Map 2017
states@data <- cbind(states@data, obesity_17)
states_17 <- states

# U.S. Map 2018
states@data <- cbind(states@data, obesity_18)
states_18 <- states

# U.S. Map 2019
states@data <- cbind(states@data, obesity_19)
states_19 <- states

# U.S. Map 2020
states@data <- cbind(states@data, obesity_20)
states_20 <- states

# U.S. Map 2021
states@data <- cbind(states@data, obesity_21)
states_21 <- states
```

## Current Problem
### BMI of Americans
```{r, echo=FALSE, message = FALSE, warning = FALSE, error = FALSE, message=FALSE, fig.width=8, fig.height=6}
annotation <- data.frame(
   x = c(17),
   y = c(48),
   label = c("Healthy Range")
)

ggplot(data=cent_final, aes(x = bmi)) +
  geom_histogram(fill='#848884') +
  annotate("rect", fill = "#184E77", alpha = 0.6, 
        xmin = 18.5, xmax = 24.9,
        ymin = 0, ymax = Inf) + 
  geom_label(data = annotation, aes(x=x, y=y, label=label)) + 
  # geom_vline(xintercept = 18.5, linetype="dashed", color = "#168AAD", size=1.5) +
  # geom_vline(xintercept = 24.9, linetype="dashed", color = "#168AAD", size=1.5) +
  theme_minimal() + 
  labs(x = 'BMI', y='Count', title="Histogram of respondents' BMI")
```

## Challenges to healthier diets 
### Fast Food Restaurants Across NYC

The following is an interactive leaflet map illustrating the distribution of franchised fast food establishments throughout the five boroughs of New York City. Although the demographic composition of each borough varies by socioeconomic status (SES), the density of these chain restaurants appears to be fairly uniform across the city landscape. These fast food outlets prioritize cost efficiency and are strategically situated to maximize accessibility and convenience, effectively permeating every block and corner of the city. Prominent examples, such as McDonald's and Subway, exemplify strategic store placement in key Manhattan locations to optimize their reach. Adopting an approach similar to manufacturing, these fast food franchises prioritize accessibility over health and nutrition. The mass-produced food items are delivered to the general public in the most efficient and cost-effective manner possible, reflecting the underlying business objectives of these establishments.

```{r, echo=FALSE, message = FALSE, warning = FALSE, error = FALSE, message=FALSE}
# Import dataset
FastFoodRestaurants <- read_csv("/Users/justin/Downloads/US_Fast_Food_Restaurants - Sheet1.csv")

# Filter data by specific state (e.g., New York) and latitude and longitude bounds
FastFoodRestaurants_NY <- FastFoodRestaurants %>% 
  filter(province == "NY" & 
         latitude >= 40.0 & latitude <= 41.0 &
         longitude >= -75.5 & longitude <= -73.5) %>%
 mutate(name = ifelse(name == "SUBWAY", "Subway", name))

# Define a color palette based on the unique restaurant names
color_palette <- colorFactor(palette = "viridis", domain = unique(FastFoodRestaurants_NY$name))

# Set the image URLs to the hosted images
mcdonalds_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/5/50/McDonald%27s_SVG_logo.svg"
subway_logo_url <- "https://1000logos.net/wp-content/uploads/2017/06/Subway-logo.png"
dunkin_donuts_logo_url <- "https://i.pinimg.com/originals/5a/f4/2b/5af42b2e31010a24ac46d2cb5a0e60a6.png"
burger_king_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/8/85/Burger_King_logo_%281999%29.svg"
taco_bell_logo_url <- "https://1000logos.net/wp-content/uploads/2017/06/Taco-Bell-Logo-1024x640.png"
kfc_logo_url <- "https://1000logos.net/wp-content/uploads/2017/03/Kfc_logo-768x432.png"
# Set the image URLs for the new restaurants
boston_market_logo_url <- "https://cdn.freebiesupply.com/logos/large/2x/boston-market-2-logo-png-transparent.png"
fuku_logo_url <- "https://eatfuku.com/wp-content/themes/fuku-3/images/logo.svg"
dominos_pizza_logo_url <- "https://1000logos.net/wp-content/uploads/2023/04/Dominos-logo.png"
baskin_robbins_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Baskin-Robbins_logo_2022.svg/2880px-Baskin-Robbins_logo_2022.svg.png"
panera_bread_logo_url <- "https://logos-download.com/wp-content/uploads/2016/11/Panera_Bread_logo_symbol.png"
wendys_logo_url <- "https://www.mashed.com/img/gallery/dont-believe-this-myth-about-the-wendys-logo/intro-1611697081.jpg"
chipotle_mexican_grill_logo_url <- "https://upload.wikimedia.org/wikipedia/en/thumb/3/3b/Chipotle_Mexican_Grill_logo.svg/1200px-Chipotle_Mexican_Grill_logo.svg.png"
little_caesars_pizza_logo_url <- "https://www.gaylordmichigan.net/wp-content/uploads/2017/06/Untitled-design-2023-03-22T114407.307.png"
popeyes_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Popeyes_logo.svg/1200px-Popeyes_logo.svg.png"
five_guys_logo_url <- "https://dynl.mktgcdn.com/p/FIoFKEm46-afGyd-Yl2FKX-ma356Q63KQxQ-4kDqcng/1001x1001.png"
sbarro_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Sbarro_logo.svg/1200px-Sbarro_logo.svg.png"
git_it_n_git_logo_url <- "https://media-cdn.grubhub.com/image/upload/d_search:browse-images:default.jpg/w_80,q_80,fl_lossy,dpr_2.0,c_fit,f_auto,h_80/w8jzu4c4zofnvdof6ssi"
b_good_logo_url <- "https://mma.prnewswire.com/media/558745/BGOOD_Logo.jpg?p=twitter"
thirty_first_avenue_gyro_logo_url <- "https://media-cdn.grubhub.com/image/upload/d_search:browse-images:default.jpg/w_80,q_80,fl_lossy,dpr_2.0,c_fit,f_auto,h_80/wopcjumnf4dvzvyj8tej"
arbys_logo_url <- "https://upload.wikimedia.org/wikipedia/commons/f/f4/Arby%27s_logo.svg"
smashburger_logo_url <- "https://nmgprod.s3.amazonaws.com/media/files/79/8e/798ee36529dc2cdc121456549c0b0051/cover_image_1617194867.png.760x400_q85_crop_upscale.png"
white_castle_logo_url <- "https://logodownload.org/wp-content/uploads/2021/05/white-castle-logo.png"
kennedy_fried_chicken_pizza_logo_url <- "https://media-cdn.grubhub.com/image/upload/d_search:browse-images:default.jpg/w_300,q_100,fl_lossy,dpr_2.0,c_fit,f_auto,h_300/iu3ttxzx4yppjmzszpct"
dairy_queen_logo_url <- "https://cdn.lovesavingsgroup.com/logos/dq.png"
blimpie_logo_url <- "https://searchvectorlogo.com/wp-content/uploads/2021/02/blimpie-americas-sub-shop-logo-vector.png"
nathans_famous_logo_url <- "https://mms.businesswire.com/media/20221214005201/en/1663867/5/Nathan%27s_Famous_Logos-27.jpg"
pizza_hut_logo_url <- "https://upload.wikimedia.org/wikipedia/sco/thumb/d/d2/Pizza_Hut_logo.svg/2177px-Pizza_Hut_logo.svg.png"
wendys_logo_url <- "https://www.clipartmax.com/png/middle/157-1572782_wendys-wendys-logo-png.png"
papa_johns_logo_url <- "https://cdn.freebiesupply.com/logos/large/2x/papa-johns-pizza-1-logo-svg-vector.svg"
westchester_burger_logo_url <- "https://www.westchesterburger.com/stamford/images/logo.png"


# Define a function to conditionally display the logos
conditional_logo <- function(restaurant_name) {
  if (restaurant_name == "McDonald's") {
    return(paste0('<img src="', mcdonalds_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Subway") {
    return(paste0('<img src="', subway_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Dunkin' Donuts") {
    return(paste0('<img src="', dunkin_donuts_logo_url, '" width="90px" height="100px">'))
  } else if (restaurant_name == "Burger King") {
    return(paste0('<img src="', burger_king_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Taco Bell") {
    return(paste0('<img src="', taco_bell_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "KFC") {
    return(paste0('<img src="', kfc_logo_url, '" width="140px" height="100px">'))
  } else if (restaurant_name == "Boston Market") {
    return(paste0('<img src="', boston_market_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Fuku") {
    return(paste0('<img src="', fuku_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Domino's Pizza") {
    return(paste0('<img src="', dominos_pizza_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Baskin-Robbins") {
    return(paste0('<img src="', baskin_robbins_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Panera Bread") {
    return(paste0('<img src="', panera_bread_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Wendy's") {
    return(paste0('<img src="', wendys_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Westchester Burger Company") {
    return(paste0('<img src="', westchester_burger_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Papa John's Pizza") {
    return(paste0('<img src="', papa_johns_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Chipotle Mexican Grill") {
    return(paste0('<img src="', chipotle_mexican_grill_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Little Caesars Pizza") {
    return(paste0('<img src"', little_caesars_pizza_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Popeyes") {
    return(paste0('<img src="', popeyes_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Five Guys") {
    return(paste0('<img src="', five_guys_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Sbarro") {
    return(paste0('<img src="', sbarro_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Git-It-N-Git") {
    return(paste0('<img src="', git_it_n_git_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "B. Good") {
    return(paste0('<img src="', b_good_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "31st Avenue Gyro") {
    return(paste0('<img src="', thirty_first_avenue_gyro_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Arby's") {
    return(paste0('<img src="', arbys_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Smashburger") {
    return(paste0('<img src="', smashburger_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "White Castle") {
    return(paste0('<img src="', white_castle_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Kennedy Fried Chicken & Pizza") {
    return(paste0('<img src="', kennedy_fried_chicken_pizza_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Dairy Queen") {
    return(paste0('<img src="', dairy_queen_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Blimpie") {
    return(paste0('<img src="', blimpie_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Nathan's Famous") {
    return(paste0('<img src="', nathans_famous_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Pizza Hut") {
    return(paste0('<img src="', pizza_hut_logo_url, '" width="100px" height="100px">'))
  } else if (restaurant_name == "Wendy's") {
    return(paste0('<img src="', wendys_logo_url, '" width="410" height="100px">'))
  } else {
    return("")
  }
}


# Create Leaflet map with marker cluster option
FastFoodRestaurants_NY_map <- leaflet(FastFoodRestaurants_NY) %>%
  addTiles() %>%
  addAwesomeMarkers(lng = ~longitude, lat = ~latitude,
                    icon = ~awesomeIcons(
                      icon = 'star',  # Choose an icon shape
                      library = 'fa', # Choose an icon library
                      markerColor = color_palette(FastFoodRestaurants_NY$name) # Set marker color based on "name" column
                    ),
                    popup = paste("Name:", FastFoodRestaurants_NY$name, "<br>",
                                  "Address:", FastFoodRestaurants_NY$address, "<br>",
                                  "City:", FastFoodRestaurants_NY$city, "<br>",
                                  "Province:", FastFoodRestaurants_NY$province, "<br>",
                                  "Postal Code:", FastFoodRestaurants_NY$postalCode, "<br>",
                                  sapply(FastFoodRestaurants_NY$name, conditional_logo)), # Add hosted image to the popup
                    clusterOptions = markerClusterOptions()) %>%
  setView(lng = -74.0060, lat = 40.7128, zoom = 10)  # Set initial map view to the center of New York City

# Display the map
FastFoodRestaurants_NY_map


```

Data: Fast Food Restaurants Across NYC | Kaggle
https://www.kaggle.com/datasets/datafiniti/fast-food-restaurants


## Potential Solutions
### Special Diets Among Adults Aged 20 and Over in the United States from 2007 to 2018

The subsequent interactive line graph highlights the prevalence of various specialized diets among adults aged 20 and over in the United States from 2007 to 2018. The diets encompass Weight Loss or Low Calorie Diet, Diabetic Diet, Low Carbohydrate Diet, and Low Fat or Low Cholesterol Diet. Notably, the Weight Loss or Low Calorie Diet experienced the most significant increase among the four diets, often linked with plant-based diets The proportion of U.S. adults following this diet escalated from 7.5 percent in 2007 to 10 percent in 2018. The Diabetic Diet remained relatively stable over time, fluctuating from 1.8 percent to 2.2 percent, as diabetic patients typically adhere to physician-prescribed diets rather than electing to adopt such diets independently. Conversely, the Low Carbohydrate Diet witnessed a substantial increase from 0.9 percent to 2.2 percent over the decade. This diet's popularity can be attributed to its association with numerous health benefits, such as promoting weight loss, enhancing blood sugar control, and bolstering overall metabolic health. The Ketogenic (Keto) Diet and the Atkins Diet serve as prime examples of low carbohydrate diet plans. Lastly, the Low Fat or Low Cholesterol Diet observed a decline in its share of dietary options. The percentage of U.S. adults adhering to a low-fat diet decreased from 2.7 percent in 2007 to 1.5 percent in 2018, suggesting that this dietary approach may have lost its appeal due to its perceived ineffectiveness in helping individuals achieve their health objectives.


```{r, echo=FALSE, message = FALSE, warning = FALSE, error = FALSE, message=FALSE}

diet_data <- data.frame(
  SurveyPeriod = c("2007–2008", "2009–2010", "2011–2012", "2013–2014", "2015–2016", "2017–2018"),
  WeightLossDiet = c(7.5, 8.8, 8.8, 9.2, 8.7, 10),
  DiabeticDiet = c(1.8, 2.4, 1.9, 2, 2.1, 2.2),
  LowCarbDiet = c(0.9, 0.9, 0.9, 1.5, 1.7, 2.2),
  LowFatDiet = c(2.7, 1.9, 1.6, 2.1, 1.9, 1.5)
)

plot <- plot_ly(data = diet_data, x = ~SurveyPeriod, y = ~WeightLossDiet, type = "scatter", mode = "lines+markers", name = "Weight Loss or Low Calorie Diet", line = list(color = "red"))
plot <- plot %>% add_trace(y = ~DiabeticDiet, name = "Diabetic Diet", line = list(color = "green"))
plot <- plot %>% add_trace(y = ~LowCarbDiet, name = "Low Carbohydrate Diet", line = list(color = "royalblue"))
plot <- plot %>% add_trace(y = ~LowFatDiet, name = "Low Fat or Low Cholesterol Diet", line = list(color = "orange"))

plot <- plot %>% layout(title = "Special Diets Among Adults in the US from 2007 to 2018",
                         xaxis = list(title = "Survey Period"),
                         yaxis = list(title = "Percentage(%)"))

plot

```


Data: Special Diets Among Adults: United States, 2015–2018 | CDC
https://www.cdc.gov/nchs/products/databriefs/db389.htm

### Datatable of Nutritional Information of the Most Common Food
To emphasize the significance of health and nutrition literacy at an individual level, an interactive, searchable data table has been assembled, enabling users to identify and sort various food items based on their respective quantities, caloric content, protein, fat, saturated fat, fiber, carbohydrate levels, and associated categories. Having comprehensive nutritional information is particularly beneficial to users adhering to specific fitness and dietary regimens tailored to their personal needs and preferences. Predominantly, the data frame comprises of ingredients that facilitate the creation of diverse and nutritious recipes. This resource serves as a valuable tool for promoting informed decision-making in relation to personal dietary choices and overall health.

```{r, echo=FALSE, message = FALSE, warning = FALSE, error = FALSE, message=FALSE}


# Read the data
df <- read.csv("/Users/justin/Downloads/nutrients_new.csv", header = FALSE, skip = 2)

# Rename columns
colnames(df) <- c("Food Name", "Measure", "Grams", "Calories(kcal)", "Protein(g)", "Fat(g)", "Saturated Fat(g)", "Fiber(g)",
                 "Carbohydrates(g)", "Category")

# Format numeric columns
df_formatted <- df %>%
  mutate(across(where(is.numeric), round, 2))

# Create a color palette for the categories
unique_categories <- unique(df_formatted$Category)
color_palette <- colorRampPalette(brewer.pal(9, "Set1"))(length(unique_categories))
names(color_palette) <- unique_categories

# Apply the category colors to the dataframe
df_formatted$CategoryColor <- color_palette[df_formatted$Category]

# Create an interactive table using DT
datatable(df_formatted[, -which(names(df_formatted) == "CategoryColor")], # remove the "CategoryColor" column
          options = list(pageLength = 10, dom = 'Bfrtip', buttons = c('csv', 'excel', 'pdf', 'print')),
          rownames = FALSE,
          caption = tags$caption(tags$style(HTML("caption {font-size: 1.5em; font-weight: bold;}")),
                                 "Nutrient Data for Various Foods"),
          extensions = c('Buttons')) %>%
  formatStyle(names(df_formatted)[-which(names(df_formatted) == "CategoryColor")], # remove the "CategoryColor" column from names(df_formatted)
              fontWeight = styleEqual(names(df_formatted)[-which(names(df_formatted) == "CategoryColor")], "bold"),
              backgroundColor = styleEqual(names(df_formatted)[-which(names(df_formatted) == "CategoryColor")], "lightblue")) %>%
  formatStyle("Food Name",
              color = "black",
              fontWeight = "bold") %>%
  formatStyle(1:nrow(df_formatted), # color the entire row based on the "CategoryColor" column
              backgroundColor = styleEqual(df_formatted$CategoryColor, df_formatted$CategoryColor),
              include = TRUE)
```

Data: Nutritional Facts for most common foods | Kaggle
https://www.kaggle.com/datasets/niharika41298/nutrition-details-for-most-common-foods


## Authors

### Justin Ko 

Graduate School of Arts and Sciences - QMSS

jk3938@columbia.edu

<img src="/Users/justin/Downloads/justin.jpg" alt="Image caption" width="150" height="auto">



### Moises Escobar 
Graduate School of Arts and Sciences - QMSS

me2801@columbia.edu

### Kexu Duan 
Graduate School of Arts and Sciences - QMSS

kd2865@columbia.edu

<img src="/Users/justin/Downloads/dora.jpg" alt="Image caption" width="150" height="225">


### Yiwei Li
Graduate School of Arts and Sciences - QMSS

yl5063@columbia.edu
